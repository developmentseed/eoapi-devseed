{% include "header.html" %}
{% if params %}
  {% set urlq = url + '?' + params + '&' %}
  {% else %}
  {% set urlq = url + '?' %}
{% endif %}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb bg-light">
    {% for crumb in crumbs %} {% if not loop.last %}
    <li class="breadcrumb-item">
      <a href="{{ crumb.url }}/">{{ crumb.part }}</a>
    </li>
    {% else %}
    <li class="breadcrumb-item active" aria-current="page">{{ crumb.part }}</li>
    {% endif %} {% endfor %}

    <li class="ml-auto json-link">
      <a target="_blank" href="{{ urlq }}f=json">JSON</a>
    </li>
  </ol>
</nav>

<h1>Collection: {{ response.title or response.id }}</h1>

<div class="row">
  <div class="col-sm">
    <p>{{ response.description or response.title or response.id }}</p>
    {% if "keywords" in response and length(response.keywords) > 0 %}
    <div id="keywords">
      <p>
        {% for keyword in response.keywords %}
        <span class="badge badge-secondary">{{ keyword }}</span>
        {% endfor %}
      </p>
    </div>
    {% endif %}

    <h2>Links</h2>
    <ul>
      {% for link in response.links %}
      <li><a href="{{ link.href }}">{{ link.title or link.rel }}</a></li>
      {% endfor %}
    </ul>
  </div>
  <div class="col-sm">
    {% if response.extent and response.extent.spatial %}
    <div id="map" class="rounded" style="width: 100%; height: 400px">
      Loading...
    </div>
    {% endif %}
  </div>
</div>

{% if response.extent and response.extent.spatial %}
<script>
  $(function() {
    const collection = {{ response|tojson }};
    var map = L.map('map').setView([0, 0], 1);
    map.addLayer(new L.TileLayer(
      'https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
      }
    ));

    for (let i = 0, len = collection.extent.spatial.bbox.length; i < len; i++) {
      const options = i === 0 ? {
        fill: false,
        weight: 2
      } : {
        color: "red",
        fill: false,
        dashArray: 2,
        weight: 1
      };
      const bbox = collection.extent.spatial.bbox[i];
      const bbox_polygon = L.polygon([
        [bbox[1], bbox[0]],
        [bbox[1], bbox[2]],
        [bbox[3], bbox[2]],
        [bbox[3], bbox[0]]
      ], options);


      map.addLayer(bbox_polygon);
      if (i === 0) {
        map.fitBounds(bbox_polygon.getBounds());
      }
    }
  });
</script>
{% endif %}

{% include "footer.html" %}
